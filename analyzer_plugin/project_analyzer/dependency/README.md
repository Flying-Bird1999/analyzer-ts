# NPM-Check åˆ†æå™¨

## æ¦‚è¿°

NPM-Check åˆ†æå™¨æ˜¯ analyzer-ts å·¥å…·ä¸­çš„æ ¸å¿ƒä¾èµ–ç®¡ç†æ’ä»¶ï¼Œä¸“é—¨ç”¨äºæ£€æµ‹å’Œåˆ†æ TypeScript/JavaScript é¡¹ç›®ä¸­ NPM ä¾èµ–çš„å¥åº·çŠ¶å†µã€‚è¯¥åˆ†æå™¨é€šè¿‡æ·±åº¦åˆ†æé¡¹ç›®ä»£ç å’Œä¾èµ–å…³ç³»ï¼Œå¸®åŠ©å¼€å‘è€…è¯†åˆ«éšå¼ä¾èµ–ã€æœªä½¿ç”¨ä¾èµ–å’Œè¿‡æ—¶ä¾èµ–ï¼Œä»è€Œä¼˜åŒ–é¡¹ç›®ä¾èµ–å…³ç³»ï¼Œæé«˜å®‰å…¨æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

## åŠŸèƒ½ç‰¹æ€§

### ğŸ” éšå¼ä¾èµ–æ£€æµ‹ï¼ˆå¹½çµä¾èµ–ï¼‰
- **å®šä¹‰è¯†åˆ«**ï¼šæ£€æµ‹åœ¨ä»£ç ä¸­ä½¿ç”¨ä½†æœªåœ¨ `package.json` ä¸­å£°æ˜çš„ä¾èµ–
- **é£é™©æç¤º**ï¼šè¯†åˆ«æ½œåœ¨çš„ä¾èµ–å…¼å®¹æ€§å’Œéƒ¨ç½²é—®é¢˜
- **ä½ç½®è¿½è¸ª**ï¼šæä¾›æ¯ä¸ªéšå¼ä¾èµ–çš„å…·ä½“ä½¿ç”¨ä½ç½®å’Œä»£ç ç‰‡æ®µ
- **æ™ºèƒ½è¿‡æ»¤**ï¼šè‡ªåŠ¨å¿½ç•¥ Node.js å†…ç½®æ¨¡å—ï¼Œé¿å…è¯¯æŠ¥

### ğŸ—‘ï¸ æœªä½¿ç”¨ä¾èµ–è¯†åˆ«
- **å…¨é¢æ‰«æ**ï¼šåˆ†ææ‰€æœ‰ `package.json` æ–‡ä»¶ä¸­çš„ä¾èµ–å£°æ˜
- **æ™ºèƒ½æ’é™¤**ï¼šè‡ªåŠ¨å¿½ç•¥å¸¸è§çš„å¼€å‘å·¥å…·å’Œæ„å»ºä¾èµ–
- **åˆ†ç±»è¯†åˆ«**ï¼šåŒºåˆ†ç”Ÿäº§ä¾èµ–å’Œå¼€å‘ä¾èµ–
- **ç‰ˆæœ¬ä¿¡æ¯**ï¼šæä¾›æœªä½¿ç”¨ä¾èµ–çš„å½“å‰ç‰ˆæœ¬ä¿¡æ¯

### ğŸ“… è¿‡æ—¶ä¾èµ–æ£€æŸ¥
- **å®æ—¶æŸ¥è¯¢**ï¼šé€šè¿‡ NPM Registry API è·å–æœ€æ–°ç‰ˆæœ¬ä¿¡æ¯
- **ç‰ˆæœ¬å¯¹æ¯”**ï¼šæ¸…æ™°æ˜¾ç¤ºå½“å‰ç‰ˆæœ¬å’Œæœ€æ–°ç‰ˆæœ¬çš„å·®å¼‚
- **å¤šåŒ…æ”¯æŒ**ï¼šæ”¯æŒ monorepo é¡¹ç›®ä¸­å¤šä¸ª `package.json` çš„åˆ†æ
- **å®‰å…¨æé†’**ï¼šæç¤ºè¿‡æ—¶ä¾èµ–å¯èƒ½å¸¦æ¥çš„å®‰å…¨é£é™©

### ğŸ§  æ™ºèƒ½è¿‡æ»¤è§„åˆ™
- **Node.js å†…ç½®æ¨¡å—**ï¼šè‡ªåŠ¨å¿½ç•¥ `fs`, `path`, `http` ç­‰æ ¸å¿ƒæ¨¡å—
- **å¼€å‘å·¥å…·å¿½ç•¥**ï¼šæ™ºèƒ½æ’é™¤ ESLintã€Prettierã€Webpack ç­‰æ„å»ºå·¥å…·
- **ç±»å‹å®šä¹‰å¿½ç•¥**ï¼šè‡ªåŠ¨å¿½ç•¥ `@types/*` åŒ…ï¼Œé¿å…è¯¯æŠ¥
- **æ¡†æ¶ç‰¹å®šå·¥å…·**ï¼šæ”¯æŒ Reactã€Vue ç­‰æ¡†æ¶çš„ç‰¹å®šå·¥å…·è¯†åˆ«

### âš¡ é«˜æ€§èƒ½åˆ†æ
- **å¹¶å‘å¤„ç†**ï¼šåŒæ—¶æ‰§è¡Œéšå¼ä¾èµ–æ£€æµ‹å’Œè¿‡æ—¶ä¾èµ–æ£€æŸ¥
- **ç½‘ç»œä¼˜åŒ–**ï¼šåˆç†çš„ NPM API è¯·æ±‚é¢‘ç‡æ§åˆ¶
- **å†…å­˜ç®¡ç†**ï¼šé«˜æ•ˆçš„æ•°æ®ç»“æ„å’Œç®—æ³•å®ç°
- **å¢é‡åˆ†æ**ï¼šæ”¯æŒå¤§å‹é¡¹ç›®å’Œ monorepo æ¶æ„

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ç”¨æ³•
```bash
# åˆ†æé¡¹ç›®çš„ NPM ä¾èµ–å¥åº·çŠ¶å†µ
./analyzer-ts analyze npm-check -i /path/to/project -o /path/to/output

# åœ¨ monorepo é¡¹ç›®ä¸­ä½¿ç”¨
./analyzer-ts analyze npm-check -i /path/to/monorepo -m

# æ’é™¤ç‰¹å®šæ–‡ä»¶æˆ–ç›®å½•
./analyzer-ts analyze npm-check -i /path/to/project -x "node_modules/**" -x "**/dist/**"
```

### é«˜çº§ç”¨æ³•
```bash
# ç»“åˆå…¶ä»–åˆ†æå™¨ä¸€èµ·ä½¿ç”¨
./analyzer-ts analyze npm-check count-any unconsumed -i /path/to/project

# æŒ‡å®šè¾“å‡ºç›®å½•
./analyzer-ts analyze npm-check -i /path/to/project -o /path/to/output-dir

# åªåˆ†æç”Ÿäº§ä¾èµ–ç›¸å…³çš„æ–‡ä»¶
./analyzer-ts analyze npm-check -i /path/to/project -x "**/*.test.ts" -x "**/config/**"
```

## è¾“å‡ºç¤ºä¾‹

### æ§åˆ¶å°è¾“å‡ºï¼ˆå¥åº·çš„ä¾èµ–çŠ¶æ€ï¼‰
```
âœ… NPM ä¾èµ–æ£€æŸ¥å®Œæˆ
   å·²å£°æ˜ä¾èµ–: 156 ä¸ª
   ä½¿ç”¨ä¸­ä¾èµ–: 142 ä¸ª
   éšå¼ä¾èµ–: 0 ä¸ª
   æœªä½¿ç”¨ä¾èµ–: 0 ä¸ª
   è¿‡æ—¶ä¾èµ–: 2 ä¸ª

âš ï¸ å‘ç° 2 ä¸ªè¿‡æ—¶ä¾èµ–ï¼š
--------------------------------------------------
   - [1.2.3 â†’ 1.3.0] lodash (packages/app/package.json)
   - [2.1.0 â†’ 2.2.0] react (packages/app/package.json)
--------------------------------------------------
```

### æ§åˆ¶å°è¾“å‡ºï¼ˆå‘ç°é—®é¢˜ï¼‰
```
âš ï¸ NPM ä¾èµ–æ£€æŸ¥å®Œæˆ
   å·²å£°æ˜ä¾èµ–: 156 ä¸ª
   ä½¿ç”¨ä¸­ä¾èµ–: 142 ä¸ª
   éšå¼ä¾èµ–: 3 ä¸ª
   æœªä½¿ç”¨ä¾èµ–: 5 ä¸ª
   è¿‡æ—¶ä¾èµ–: 8 ä¸ª

âš ï¸ å‘ç° 3 ä¸ªéšå¼ä¾èµ–ï¼ˆå¹½çµä¾èµ–ï¼‰ï¼š
--------------------------------------------------
   - moment.js (/src/utils/date.ts:15)
   - lodash (/src/helpers/formatter.ts:8)
   - axios (/src/services/api.ts:12)
--------------------------------------------------

âš ï¸ å‘ç° 5 ä¸ªæœªä½¿ç”¨ä¾èµ–ï¼š
--------------------------------------------------
   - unused-package [1.0.0] (packages/app/package.json)
   - old-plugin [2.1.0] (packages/app/package.json)
   - legacy-tool [0.8.0] (packages/components/package.json)
--------------------------------------------------

âš ï¸ å‘ç° 8 ä¸ªè¿‡æ—¶ä¾èµ–ï¼š
--------------------------------------------------
   - [1.2.3 â†’ 1.3.0] lodash (packages/app/package.json)
   - [16.13.1 â†’ 17.0.1] react (packages/app/package.json)
   - [4.17.0 â†’ 4.18.0] @testing-library/react (packages/app/package.json)
--------------------------------------------------
```

### JSON è¾“å‡º
```json
{
  "implicitDependencies": [
    {
      "name": "moment.js",
      "filePath": "/src/utils/date.ts",
      "raw": "import moment from 'moment.js';"
    },
    {
      "name": "lodash",
      "filePath": "/src/helpers/formatter.ts",
      "raw": "import { debounce } from 'lodash';"
    }
  ],
  "unusedDependencies": [
    {
      "name": "unused-package",
      "version": "1.0.0",
      "packageJsonPath": "packages/app/package.json"
    }
  ],
  "outdatedDependencies": [
    {
      "name": "lodash",
      "currentVersion": "1.2.3",
      "latestVersion": "1.3.0",
      "packageJsonPath": "packages/app/package.json"
    }
  ]
}
```

## æŠ€æœ¯æ¶æ„

### å·¥ä½œåŸç†
åˆ†æå™¨é‡‡ç”¨å¤šçº¿ç¨‹å¹¶å‘æ¶æ„ï¼ŒåŒæ—¶æ‰§è¡Œä¸‰ç§ä¸åŒçš„æ£€æŸ¥ä»»åŠ¡ï¼š

1. **éšå¼ä¾èµ–æ£€æµ‹**
   - åˆ†ææ‰€æœ‰æºç æ–‡ä»¶çš„å¯¼å…¥è¯­å¥
   - å¯¹æ¯” `package.json` ä¸­å£°æ˜çš„ä¾èµ–
   - è¯†åˆ«æœªå£°æ˜çš„åŒ…ä½¿ç”¨
   - è¿‡æ»¤ Node.js å†…ç½®æ¨¡å—

2. **æœªä½¿ç”¨ä¾èµ–è¯†åˆ«**
   - æ”¶é›†æ‰€æœ‰ `package.json` ä¸­çš„ä¾èµ–å£°æ˜
   - åˆ†æä»£ç ä¸­å®é™…ä½¿ç”¨çš„å¯¼å…¥
   - è¯†åˆ«å£°æ˜çš„ä½†æœªä½¿ç”¨çš„ä¾èµ–
   - æ™ºèƒ½è¿‡æ»¤å¼€å‘å·¥å…·å’Œç±»å‹åŒ…

3. **è¿‡æ—¶ä¾èµ–æ£€æŸ¥**
   - å‘ NPM Registry API å‘é€è¯·æ±‚
   - è·å–æ¯ä¸ªä¾èµ–çš„æœ€æ–°ç‰ˆæœ¬ä¿¡æ¯
   - å¯¹æ¯”å½“å‰ç‰ˆæœ¬å’Œæœ€æ–°ç‰ˆæœ¬
   - ç”Ÿæˆç‰ˆæœ¬å·®å¼‚æŠ¥å‘Š

### æ ¸å¿ƒç»„ä»¶
```go
// åˆ†æå™¨ä¸»ä½“
type Checker struct{}

// éšå¼ä¾èµ–ä¿¡æ¯
type ImplicitDependency struct {
    Name     string // åŒ…å
    FilePath string // ä½¿ç”¨ä½ç½®
    Raw      string // å¯¼å…¥è¯­å¥
}

// æœªä½¿ç”¨ä¾èµ–ä¿¡æ¯
type UnusedDependency struct {
    Name            string // åŒ…å
    Version         string // å½“å‰ç‰ˆæœ¬
    PackageJsonPath string // package.json è·¯å¾„
}

// è¿‡æ—¶ä¾èµ–ä¿¡æ¯
type OutdatedDependency struct {
    Name            string // åŒ…å
    CurrentVersion  string // å½“å‰ç‰ˆæœ¬
    LatestVersion   string // æœ€æ–°ç‰ˆæœ¬
    PackageJsonPath string // package.json è·¯å¾„
}
```

## æœ€ä½³å®è·µ

### 1. å®šæœŸä¾èµ–å¥åº·æ£€æŸ¥
```bash
# åœ¨ CI/CD ä¸­é›†æˆä¾èµ–æ£€æŸ¥
./analyzer-ts analyze npm-check -i ./src --fail-on-implicit

# æ¯å‘¨è¿è¡Œä¸€æ¬¡å®Œæ•´çš„ä¾èµ–åˆ†æ
./analyzer-ts analyze npm-check -i ./ -o ./reports/npm-health-$(date +%Y%m%d).json
```

### 2. é€æ­¥ä¼˜åŒ–ä¾èµ–
```bash
# é¦–å…ˆå¤„ç†éšå¼ä¾èµ–ï¼ˆæœ€ç´§æ€¥ï¼‰
./analyzer-ts analyze npm-check -i ./src | grep "éšå¼ä¾èµ–"

# ç„¶åæ¸…ç†æœªä½¿ç”¨ä¾èµ–
./analyzer-ts analyze npm-check -i ./src | grep "æœªä½¿ç”¨ä¾èµ–"

# æœ€åæ›´æ–°è¿‡æ—¶ä¾èµ–
./analyzer-ts analyze npm-check -i ./src | grep "è¿‡æ—¶ä¾èµ–"
```

### 3. å›¢é˜Ÿåä½œ
```bash
# åœ¨ä»£ç åˆå¹¶å‰è¿è¡Œæ£€æŸ¥
./analyzer-ts analyze npm-check -i ./src -o ./reports/pre-merge-$(date +%Y%m%d).json

# ç”Ÿæˆä¾èµ–å¥åº·æŠ¥å‘Š
./analyzer-ts analyze npm-check -i ./ -o ./reports/dependency-health.json
```

## æ€§èƒ½è€ƒè™‘

### åˆ†æé€Ÿåº¦
- **å°å‹é¡¹ç›®**ï¼ˆ<50 ä¾èµ–ï¼‰ï¼šé€šå¸¸åœ¨ 3-5 ç§’å†…å®Œæˆ
- **ä¸­å‹é¡¹ç›®**ï¼ˆ50-200 ä¾èµ–ï¼‰ï¼šé€šå¸¸åœ¨ 8-15 ç§’å†…å®Œæˆ
- **å¤§å‹é¡¹ç›®**ï¼ˆ>200 ä¾èµ–ï¼‰ï¼šé€šå¸¸åœ¨ 15-30 ç§’å†…å®Œæˆ

### ç½‘ç»œè¦æ±‚
- éœ€è¦è®¿é—® NPM Registry API (registry.npmjs.org)
- æ¯ä¸ªä¾èµ–ä¼šå‘é€ä¸€ä¸ª HTTP GET è¯·æ±‚
- æ”¯æŒç¦»çº¿æ¨¡å¼ï¼ˆè·³è¿‡è¿‡æ—¶ä¾èµ–æ£€æŸ¥ï¼‰

### å†…å­˜ä½¿ç”¨
- å†…å­˜ä½¿ç”¨ä¸ä¾èµ–æ•°é‡å’Œé¡¹ç›®å¤§å°ç›¸å…³
- ä½¿ç”¨å¹¶å‘ goroutine ä¼˜åŒ–æ€§èƒ½
- å¯¹å¤§å‹ monorepo é¡¹ç›®æ”¯æŒå¢é‡åˆ†æ

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ç½‘ç»œè¿æ¥é—®é¢˜**
   ```bash
   # æ£€æŸ¥ç½‘ç»œè¿æ¥
   curl https://registry.npmjs.org/lodash

   # å¦‚æœç½‘ç»œä¸ç¨³å®šï¼Œå¯ä»¥è·³è¿‡è¿‡æ—¶æ£€æŸ¥
   # ï¼ˆå½“å‰åˆ†æå™¨æš‚ä¸æ”¯æŒæ­¤åŠŸèƒ½ï¼Œå»ºè®®åœ¨ç½‘ç»œæ­£å¸¸æ—¶è¿è¡Œï¼‰
   ```

2. **è¯¯æŠ¥é—®é¢˜**
   ```bash
   # æŸäº›å¼€å‘å·¥å…·è¢«è¯¯æŠ¥ä¸ºæœªä½¿ç”¨
   # å¯ä»¥é€šè¿‡ä¿®æ”¹ devDependencyIgnoreList æ·»åŠ å¿½ç•¥è§„åˆ™
   ```

3. **åˆ†ææ—¶é—´è¿‡é•¿**
   ```bash
   # æ’é™¤ä¸å¿…è¦çš„æ–‡ä»¶
   ./analyzer-ts analyze npm-check -i /path/to/project -x "**/node_modules/**" -x "**/dist/**"

   # åˆ†æ¨¡å—åˆ†æï¼ˆé’ˆå¯¹è¶…å¤§å‹é¡¹ç›®ï¼‰
   ./analyzer-ts analyze npm-check -i /path/to/project/packages/app
   ```

### ç†è§£æ£€æŸ¥ç»“æœ

1. **éšå¼ä¾èµ–çš„å¤„ç†å»ºè®®**
   - ç«‹å³åœ¨ `package.json` ä¸­å£°æ˜è¿™äº›ä¾èµ–
   - æ£€æŸ¥æ˜¯å¦æœ‰æ›´åˆé€‚çš„æ›¿ä»£åŒ…
   - è¯„ä¼°æ˜¯å¦çœŸçš„éœ€è¦è¿™ä¸ªä¾èµ–

2. **æœªä½¿ç”¨ä¾èµ–çš„å¤„ç†å»ºè®®**
   - å¦‚æœç¡®å®ä¸éœ€è¦ï¼Œå¯ä»¥å®‰å…¨åˆ é™¤
   - æ£€æŸ¥æ˜¯å¦è¢«é…ç½®æ–‡ä»¶é—´æ¥ä½¿ç”¨
   - è€ƒè™‘æ˜¯å¦ä¸ºå¯é€‰é¡¹ä¾èµ–ï¼ˆoptional dependenciesï¼‰

3. **è¿‡æ—¶ä¾èµ–çš„å¤„ç†å»ºè®®**
   - è¯„ä¼°å‡çº§é£é™©ï¼ˆbreaking changesï¼‰
   - æŸ¥çœ‹æ›´æ–°æ—¥å¿—äº†è§£å…·ä½“æ”¹è¿›
   - ä¼˜å…ˆå¤„ç†å®‰å…¨ç›¸å…³çš„æ›´æ–°

## æ‰©å±•å’Œå®šåˆ¶

### æ·»åŠ è‡ªå®šä¹‰å¿½ç•¥è§„åˆ™
å¯ä»¥é€šè¿‡ä¿®æ”¹ `devDependencyIgnoreList` å˜é‡æ¥æ·»åŠ é¡¹ç›®ç‰¹å®šçš„å¿½ç•¥è§„åˆ™ï¼š

```go
// åœ¨ filters.go æ–‡ä»¶ä¸­æ·»åŠ 
var devDependencyIgnoreList = map[string]bool{
    // é»˜è®¤è§„åˆ™...

    // æ·»åŠ é¡¹ç›®ç‰¹å®šçš„å¿½ç•¥è§„åˆ™
    "your-custom-tool": true,
    "@your-scope/your-package": true,
}
```

### é›†æˆåˆ° CI/CD æµç¨‹
```yaml
# GitHub Actions ç¤ºä¾‹
- name: æ£€æŸ¥ NPM ä¾èµ–å¥åº·çŠ¶å†µ
  run: ./analyzer-ts analyze npm-check -i ./src -o npm-check.json
- name: å¦‚æœå‘ç°éšå¼ä¾èµ–åˆ™å¤±è´¥
  if: steps.npm-check.outputs.implicit_count > 0
  run: echo "å‘ç°éšå¼ä¾èµ–ï¼Œè¯·ä¿®æ­£ä¾èµ–å£°æ˜"
- name: ç”Ÿæˆä¾èµ–æŠ¥å‘Š
  run: |
    echo "## ä¾èµ–å¥åº·æŠ¥å‘Š" >> $GITHUB_STEP_SUMMARY
    cat npm-check.json >> $GITHUB_STEP_SUMMARY
```

### é›†æˆåˆ°æ„å»ºè„šæœ¬
```bash
# package.json scripts ç¤ºä¾‹
{
  "scripts": {
    "check-deps": "analyzer-ts analyze npm-check -i ./src",
    "prebuild": "npm run check-deps",
    "predeploy": "npm run check-deps"
  }
}
```

## ç‰ˆæœ¬å†å²

- **v1.0.0**: åˆå§‹ç‰ˆæœ¬ï¼ŒåŸºæœ¬çš„ä¾èµ–æ£€æŸ¥åŠŸèƒ½
- **v1.1.0**: æ·»åŠ éšå¼ä¾èµ–æ£€æµ‹å’Œæ™ºèƒ½è¿‡æ»¤
- **v1.2.0**: æ·»åŠ è¿‡æ—¶ä¾èµ–æ£€æŸ¥å’Œç½‘ç»œä¼˜åŒ–
- **v1.3.0**: æ”¯æŒ monorepo é¡¹ç›®ï¼Œæ€§èƒ½ä¼˜åŒ–
- **v1.4.0**: æ”¹è¿›è¾“å‡ºæ ¼å¼ï¼Œå¢åŠ æ›´å¤šç»Ÿè®¡ä¿¡æ¯

## ç›¸å…³é“¾æ¥

- [analyzer-ts é¡¹ç›®ä¸»é¡µ](../../README.md)
- [åˆ†æå™¨æ¶æ„æ–‡æ¡£](../README.md)
- [Unconsumed åˆ†æå™¨](../unconsumed/README.md)
- [NPM Registry API æ–‡æ¡£](https://github.com/npm/registry)
- [Node.js å†…ç½®æ¨¡å—åˆ—è¡¨](https://nodejs.org/api/modules.html#modules-builtin-modules)

---

ğŸ’¡ **æç¤º**: ä¾èµ–å¥åº·æ˜¯é¡¹ç›®é•¿æœŸç»´æŠ¤çš„å…³é”®ã€‚å»ºè®®å®šæœŸè¿è¡Œæ­¤åˆ†æå™¨ï¼Œç‰¹åˆ«æ˜¯åœ¨æ·»åŠ æ–°ä¾èµ–ã€å‡çº§ä¾èµ–ç‰ˆæœ¬æˆ–å‡†å¤‡å‘å¸ƒæ–°ç‰ˆæœ¬æ—¶ã€‚å¤„ç†å¥½éšå¼ä¾èµ–å’Œè¿‡æ—¶ä¾èµ–å¯ä»¥æ˜¾è‘—æé«˜é¡¹ç›®çš„ç¨³å®šæ€§å’Œå®‰å…¨æ€§ã€‚