# TSMorphGo Symbol æ¨¡å—é‡æ–°è®¾è®¡æ–¹æ¡ˆ

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜äº†åŸºäº TypeScript-Go `Checker.GetSymbolAtLocation` çš„å…¨æ–° Symbol æ¨¡å—å®ç°æ–¹æ¡ˆï¼Œæ›¿ä»£äº†åŸæœ‰çš„ç®€å•å®ç°ï¼Œæä¾›çœŸæ­£çš„ TypeScript ç¼–è¯‘å™¨çº§åˆ«çš„è¯­ä¹‰åˆ†æèƒ½åŠ›ã€‚

## ğŸ¯ è®¾è®¡ç›®æ ‡

- **çœŸæ­£çš„è¯­ä¹‰åˆ†æ**: åŸºäº TypeScript ç¼–è¯‘å™¨çš„ç¬¦å·ç³»ç»Ÿï¼Œè€Œéç®€å•çš„æ–‡æœ¬åŒ¹é…
- **é«˜æ€§èƒ½ç¼“å­˜**: å®ç°ç¬¦å·ç¼“å­˜æœºåˆ¶ï¼Œé¿å…é‡å¤çš„ç¼–è¯‘å™¨è°ƒç”¨
- **API å…¼å®¹æ€§**: ä¿æŒä¸ç°æœ‰ TSMorphGo API çš„å…¼å®¹æ€§
- **ç±»å‹å®‰å…¨**: å®Œæ•´çš„ç¬¦å·æ ‡å¿—å’Œç±»å‹æ£€æŸ¥åŠŸèƒ½
- **å¯æ‰©å±•æ€§**: æ”¯æŒç¬¦å·ä½œç”¨åŸŸç®¡ç†å’Œé«˜çº§æŸ¥è¯¢åŠŸèƒ½

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ ¸å¿ƒç»„ä»¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                TSMorphGo Symbol å±‚              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Symbol    â”‚ â”‚SymbolManagerâ”‚ â”‚SymbolScope  â”‚  â”‚
â”‚  â”‚  (åŒ…è£…å™¨)    â”‚ â”‚  (ç®¡ç†å™¨)    â”‚ â”‚ (ä½œç”¨åŸŸ)     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            TypeChecker é›†æˆå±‚                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚Project      â”‚ â”‚ TypeChecker â”‚ â”‚   Program   â”‚  â”‚
â”‚  â”‚ (æä¾›è€…)     â”‚ â”‚ (ç¬¦å·æŸ¥è¯¢)    â”‚ â”‚ (é¡¹ç›®ä¸Šä¸‹æ–‡) â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         TypeScript-Go åŸºç¡€è®¾æ–½å±‚                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚checker.Checkerâ”‚ â”‚ast.Symbol   â”‚ â”‚SymbolFlags  â”‚  â”‚
â”‚  â”‚(ç¬¦å·æŸ¥è¯¢)    â”‚ â”‚ (åŸç”Ÿç¬¦å·)  â”‚ â”‚ (æ ‡å¿—æšä¸¾)   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ æ ¸å¿ƒå®ç°

### 1. Symbol ç»“æ„é‡æ–°è®¾è®¡

```go
type Symbol struct {
    nativeSymbol *ast.Symbol     // åŸç”Ÿ TypeScript ç¬¦å·
    name         string          // ç¬¦å·åç§°
    flags        ast.SymbolFlags // ç¬¦å·æ ‡å¿—
    declarations []*Node         // å£°æ˜èŠ‚ç‚¹
    exported     bool            // å¯¼å‡ºçŠ¶æ€
    documentation string         // æ–‡æ¡£ä¿¡æ¯
    mu           sync.RWMutex    // çº¿ç¨‹å®‰å…¨
}
```

**å…³é”®æ”¹è¿›**:
- **åŸç”Ÿç¬¦å·é›†æˆ**: ç›´æ¥åŒ…è£… `ast.Symbol`ï¼Œè·å¾—å®Œæ•´çš„ç¼–è¯‘å™¨ä¿¡æ¯
- **ç¬¦å·æ ‡å¿—æ”¯æŒ**: åŸºäº `ast.SymbolFlags` çš„å®Œæ•´ç¬¦å·ç±»å‹è¯†åˆ«
- **å£°æ˜ä¿¡æ¯**: æä¾›ç¬¦å·çš„æ‰€æœ‰å£°æ˜èŠ‚ç‚¹è®¿é—®
- **å¯¼å‡ºçŠ¶æ€**: å‡†ç¡®è¯†åˆ«å¯¼å‡ºç¬¦å·

### 2. SymbolManager ç¬¦å·ç®¡ç†å™¨

```go
type SymbolManager struct {
    provider TypeCheckerProvider
    cache    map[string]*Symbol
    mu       sync.RWMutex
}
```

**æ ¸å¿ƒåŠŸèƒ½**:
- **ç¼“å­˜æœºåˆ¶**: åŸºäºä½ç½®çš„ç¬¦å·ç¼“å­˜ï¼Œé¿å…é‡å¤æŸ¥è¯¢
- **TypeChecker é›†æˆ**: é€šè¿‡ `checker.Checker.GetSymbolAtLocation` è·å–ç¬¦å·
- **ä½œç”¨åŸŸç®¡ç†**: æ”¯æŒç¬¦å·ä½œç”¨åŸŸçš„åˆ›å»ºå’ŒæŸ¥è¯¢
- **çº¿ç¨‹å®‰å…¨**: å®Œæ•´çš„å¹¶å‘è®¿é—®ä¿æŠ¤

### 3. TypeChecker æä¾›è€…æ¥å£

```go
type TypeCheckerProvider interface {
    GetTypeChecker() (*checker.Checker, error)
    GetProgram() (*ast.Node, error)
}
```

**è®¾è®¡ä¼˜åŠ¿**:
- **è§£è€¦è®¾è®¡**: å°† TypeChecker è·å–é€»è¾‘æŠ½è±¡åŒ–
- **å¯æµ‹è¯•æ€§**: æ”¯æŒæ¨¡æ‹Ÿå®ç°è¿›è¡Œå•å…ƒæµ‹è¯•
- **æ‰©å±•æ€§**: å¯ä»¥æ”¯æŒä¸åŒçš„ TypeChecker å®ç°æ–¹å¼

## ğŸ“Š API å¯¹æ¯”

### åŸæœ‰å®ç° vs æ–°å®ç°

| åŠŸèƒ½ | åŸæœ‰å®ç° | æ–°å®ç° |
|------|----------|--------|
| ç¬¦å·è·å– | åŸºäºèŠ‚ç‚¹æ–‡æœ¬ | `checker.GetSymbolAtLocation` |
| ç¬¦å·ç±»å‹ | æ—  | å®Œæ•´çš„ `ast.SymbolFlags` æ”¯æŒ |
| å£°æ˜ä¿¡æ¯ | æ—  | å®Œæ•´çš„å£°æ˜èŠ‚ç‚¹åˆ—è¡¨ |
| å¯¼å‡ºçŠ¶æ€ | æ—  | å‡†ç¡®çš„å¯¼å‡ºæ ‡å¿—æ£€æŸ¥ |
| ç¼“å­˜æœºåˆ¶ | æ—  | åŸºäºä½ç½®çš„æ™ºèƒ½ç¼“å­˜ |
| ä½œç”¨åŸŸç®¡ç† | æ—  | å®Œæ•´çš„ä½œç”¨åŸŸç³»ç»Ÿ |

### æ–°å¢ API

```go
// ç¬¦å·ç±»å‹æ£€æŸ¥
func (s *Symbol) IsVariable() bool
func (s *Symbol) IsFunction() bool
func (s *Symbol) IsClass() bool
func (s *Symbol) IsInterface() bool
func (s *Symbol) IsEnum() bool
func (s *Symbol) IsModule() bool
func (s *Symbol) IsTypeAlias() bool
func (s *Symbol) IsMethod() bool
func (s *Symbol) IsProperty() bool

// å£°æ˜è®¿é—®
func (s *Symbol) GetDeclarations() []*Node
func (s *Symbol) GetDeclarationCount() int
func (s *Symbol) GetFirstDeclaration() (*Node, bool)

// ç¬¦å·ç®¡ç†
func (sm *SymbolManager) GetCacheStats() int
func (sm *SymbolManager) ClearCache()
func (sm *SymbolManager) FindSymbolsByName(scope *SymbolScope, name string) []*Symbol

// é¡¹ç›®çº§åˆ«
func (p *Project) GetGlobalSymbolScope() *SymbolScope
func (p *Project) FindSymbolsByName(name string) []*Symbol
func (p *Project) ClearSymbolCache()
```

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€ç”¨æ³•

```go
// åˆ›å»ºé¡¹ç›®
project := NewProjectFromSources(map[string]string{
    "/test.ts": `
        export function testFunction(): string {
            return "hello";
        }
    `,
})

// è·å–æºæ–‡ä»¶
sourceFile := project.GetSourceFile("/test.ts")

// æŸ¥æ‰¾å‡½æ•°ç¬¦å·
sourceFile.ForEachDescendant(func(node Node) {
    if IsIdentifier(node) && node.GetText() == "testFunction" {
        symbol, err := GetSymbol(node)
        if err == nil && symbol != nil {
            fmt.Printf("Found symbol: %s\n", symbol.String())
            fmt.Printf("Is function: %v\n", symbol.IsFunction())
            fmt.Printf("Is exported: %v\n", symbol.IsExported())
            fmt.Printf("Declarations: %d\n", symbol.GetDeclarationCount())
        }
    }
})
```

### é«˜çº§æŸ¥è¯¢

```go
// è·å–å…¨å±€ä½œç”¨åŸŸ
globalScope := project.GetGlobalSymbolScope()

// æŸ¥æ‰¾ç¬¦å·
symbols := project.FindSymbolsByName("testFunction")
for _, symbol := range symbols {
    fmt.Printf("Found: %s\n", symbol.GetName())
}

// ç¼“å­˜ç®¡ç†
fmt.Printf("Cache size: %d\n", project.getSymbolManager().GetCacheStats())
project.ClearSymbolCache()
```

## ğŸ” æŠ€æœ¯ç»†èŠ‚

### ç¼“å­˜é”®ç”Ÿæˆ

```go
func (sm *SymbolManager) getCacheKey(node Node) string {
    return fmt.Sprintf("%s:%d:%d",
        node.GetSourceFile().GetFilePath(),
        node.GetStartLineNumber(),
        node.GetStartLineCharacter())
}
```

**è®¾è®¡ç†å¿µ**:
- **å”¯ä¸€æ€§**: åŸºäºæ–‡ä»¶è·¯å¾„ã€è¡Œå·ã€åˆ—å·ç¡®ä¿é”®çš„å”¯ä¸€æ€§
- **ç¨³å®šæ€§**: æ–‡ä»¶å†…å®¹å˜åŒ–ä¸å½±å“ç¼“å­˜é”®çš„ç»“æ„
- **æ€§èƒ½**: å­—ç¬¦ä¸²æ‹¼æ¥æˆæœ¬ä½ï¼Œç¼“å­˜å‘½ä¸­ç‡é«˜

### ç¬¦å·åŒ…è£…ç­–ç•¥

```go
func (sm *SymbolManager) wrapNativeSymbol(nativeSymbol *ast.Symbol, node Node) *Symbol {
    return &Symbol{
        nativeSymbol: nativeSymbol,
        name:         nativeSymbol.Name,
        flags:        nativeSymbol.Flags,
        exported:     sm.isExportedSymbol(nativeSymbol),
        // ...
    }
}
```

**æ ¸å¿ƒåŸåˆ™**:
- **ä¿¡æ¯ä¿ç•™**: ä¿æŒåŸç”Ÿç¬¦å·çš„æ‰€æœ‰ä¿¡æ¯
- **å¢é‡å¢å¼º**: åœ¨ä¸ä¸¢å¤±ä¿¡æ¯çš„åŸºç¡€ä¸Šå¢åŠ ä¾¿åˆ©åŠŸèƒ½
- **å†…å­˜æ•ˆç‡**: å¼•ç”¨åŸç”Ÿç¬¦å·ï¼Œé¿å…æ•°æ®å¤åˆ¶

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### 1. æ‡’åŠ è½½æœºåˆ¶
- TypeChecker æŒ‰éœ€åˆ›å»ºï¼Œé¿å…åˆå§‹åŒ–å¼€é”€
- ç¬¦å·ä¿¡æ¯ç¼“å­˜ï¼Œé¿å…é‡å¤è®¡ç®—

### 2. å†…å­˜ç®¡ç†
- åŸºäº sync.Once çš„å•ä¾‹æ¨¡å¼
- æ™ºèƒ½ç¼“å­˜æ¸…ç†æœºåˆ¶

### 3. å¹¶å‘ä¼˜åŒ–
- è¯»å†™é”ä¿æŠ¤å…±äº«çŠ¶æ€
- ç»†ç²’åº¦é”å‡å°‘ç«äº‰

## ğŸ§ª æµ‹è¯•è¦†ç›–

### æµ‹è¯•æ–‡ä»¶
- `symbol_enhanced_test.go`: å…¨é¢çš„ç¬¦å·åŠŸèƒ½æµ‹è¯•
- è¦†ç›–åŸºç¡€åŠŸèƒ½ã€ç±»å‹æ£€æŸ¥ã€ç¼“å­˜æœºåˆ¶ã€é”™è¯¯å¤„ç†

### æµ‹è¯•åœºæ™¯
1. **åŸºç¡€åŠŸèƒ½æµ‹è¯•**: SymbolManager åˆ›å»ºã€ç¼“å­˜ç»Ÿè®¡
2. **ç¬¦å·è·å–æµ‹è¯•**: GetSymbolAtLocation é›†æˆ
3. **ç±»å‹æ£€æŸ¥æµ‹è¯•**: å„ç§ç¬¦å·ç±»å‹çš„è¯†åˆ«
4. **å£°æ˜æµ‹è¯•**: ç¬¦å·å£°æ˜ä¿¡æ¯çš„æå–
5. **ç¼“å­˜æµ‹è¯•**: ç¼“å­˜æœºåˆ¶çš„æœ‰æ•ˆæ€§éªŒè¯
6. **é›†æˆæµ‹è¯•**: ä¸ Project æ¨¡å—çš„åä½œ
7. **é”™è¯¯å¤„ç†æµ‹è¯•**: å¼‚å¸¸æƒ…å†µçš„ä¼˜é›…å¤„ç†

## ğŸ”® åç»­å‘å±•

### çŸ­æœŸè®¡åˆ’
1. **å®Œå–„ TypeChecker é›†æˆ**: å®ç°å®Œæ•´çš„ Program å’Œ Checker åˆ›å»º
2. **ç¬¦å·å…³ç³»åˆ†æ**: å®ç°ç¬¦å·é—´çš„ä¾èµ–å…³ç³»åˆ†æ
3. **æ€§èƒ½ä¼˜åŒ–**: å¢åŠ æ‰¹é‡æŸ¥è¯¢å’Œé¢„å–æœºåˆ¶

### é•¿æœŸè§„åˆ’
1. **é‡æ„æ“ä½œ**: åŸºäºç¬¦å·ç³»ç»Ÿçš„ä»£ç é‡æ„ API
2. **ç±»å‹æ¨æ–­**: é«˜çº§ç±»å‹æ¨æ–­å’Œåˆ†æåŠŸèƒ½
3. **IDE é›†æˆ**: æ›´æ·±åº¦çš„ LSP åŠŸèƒ½é›†æˆ

## ğŸ“‹ æ€»ç»“

æ–°çš„ Symbol æ¨¡å—å®ç°æ ‡å¿—ç€ TSMorphGo ä»ç®€å•çš„ AST æ“ä½œå·¥å…·å‘çœŸæ­£çš„ TypeScript è¯­ä¹‰åˆ†æå¹³å°çš„é‡è¦è½¬å˜ã€‚é€šè¿‡é›†æˆ TypeScript-Go çš„ç¼–è¯‘å™¨ç¬¦å·ç³»ç»Ÿï¼Œæˆ‘ä»¬è·å¾—äº†ï¼š

- **å‡†ç¡®æ€§å’Œå¯é æ€§**: åŸºäºå®˜æ–¹ç¼–è¯‘å™¨çš„è¯­ä¹‰åˆ†æ
- **å®Œæ•´çš„åŠŸèƒ½è¦†ç›–**: æ”¯æŒæ‰€æœ‰ TypeScript ç¬¦å·ç±»å‹
- **é«˜æ€§èƒ½**: æ™ºèƒ½ç¼“å­˜å’Œæ‡’åŠ è½½æœºåˆ¶
- **è‰¯å¥½çš„æ‰©å±•æ€§**: ä¸ºåç»­é«˜çº§åŠŸèƒ½å¥ å®šåŸºç¡€

è¿™ä¸ªé‡æ–°è®¾è®¡ä¸º TSMorphGo é¡¹ç›®æä¾›äº†å¼ºå¤§çš„è¯­ä¹‰åˆ†æåŸºç¡€ï¼Œå°†æ˜¾è‘—æå‡ä»£ç åˆ†æã€é‡æ„å’Œå·¥å…·å¼€å‘çš„èƒ½åŠ›ã€‚